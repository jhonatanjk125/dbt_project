version: 2

models:
  - name: stg_tickets
    description: "Cleaned and type-cast support tickets from the raw source."
    columns:
      - name: ticket_id
        description: "Unique ticket identifier (e.g., TK-1001)."
        data_tests:
          - unique
          - not_null
      - name: customer_id
        description: "FK to the customer who submitted the ticket."
        data_tests:
          - not_null
          - relationships:
              arguments:
                to: ref('stg_customers')
                field: customer_id
      - name: agent_id
        description: "FK to the assigned support agent."
        data_tests:
          - relationships:
              arguments:
                to: ref('stg_agents')
                field: agent_id
      - name: channel
        description: "Submission channel: email, chat, or phone."
        data_tests:
          - accepted_values:
              arguments:
                values: ['email', 'chat', 'phone']
      - name: priority
        description: "Ticket priority: critical, high, medium, or low."
        data_tests:
          - accepted_values:
              arguments:
                values: ['critical', 'high', 'medium', 'low']
      - name: category
        description: "Issue category (e.g., billing_dispute, technical_issue)."
      - name: status
        description: "Current status: open or resolved."
        data_tests:
          - accepted_values:
              arguments:
                values: ['open', 'resolved']
      - name: created_at
        description: "Timestamp when the ticket was created."
        data_tests:
          - not_null
      - name: first_response_at
        description: "Timestamp of the first agent response."
      - name: resolved_at
        description: "Timestamp when the ticket was resolved (null if still open)."
      - name: satisfaction_score
        description: "Customer satisfaction rating 1-5 (null if not yet rated)."

  - name: stg_customers
    description: "Cleaned customer accounts with plan and revenue details."
    columns:
      - name: customer_id
        description: "Unique customer identifier."
        data_tests:
          - unique
          - not_null
      - name: plan_tier
        description: "Subscription tier: starter, professional, or enterprise."
        data_tests:
          - accepted_values:
              arguments:
                values: ['starter', 'professional', 'enterprise']
      - name: monthly_revenue
        description: "Monthly recurring revenue from this customer."

  - name: stg_agents
    description: "Cleaned support agent records."
    columns:
      - name: agent_id
        description: "Unique agent identifier."
        data_tests:
          - unique
          - not_null
      - name: team
        description: "Support tier: tier_1 or tier_2."
      - name: shift
        description: "Agent shift: morning, afternoon, or overnight."

  - name: stg_sla_definitions
    description: "SLA time targets per ticket priority level."
    columns:
      - name: priority
        description: "Priority level key."
        data_tests:
          - unique
          - not_null